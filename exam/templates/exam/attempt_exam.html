{% extends 'accounts/base.html' %}
{% block content %}

<h2 class="mb-4">Attempt Exam: {{ exam.title }}</h2>

<!-- Total Marks -->
<!-- <p class="alert alert-success"><strong>Total Marks:</strong> {{ exam.total_marks }}</p> -->
<p class="alert alert-success"><strong>Total Marks:</strong> {{ total_marks }}</p>





<!-- Countdown Timer -->
<div class="alert alert-info">
    <strong>Time Remaining:</strong> <span id="timer">05:00</span>
   

</div>

<form method="post" action="{% url 'submit_exam' exam.id %}" id="examForm">
    {% csrf_token %}
    
    {% for question in questions %}
    <div class="mb-4 border rounded p-3 shadow-sm bg-light">
        <p class="fw-bold">Q{{ forloop.counter }}. {{ question.question_text }}</p>
        <p><i class="text-muted">Marks: {{ question.marks }}</i></p>
         

        <div class="ms-3">
            <div class="form-check my-1">
                <input class="form-check-input" type="radio" name="{{ question.id }}" id="q{{ question.id }}_1" value="1" required>
                <label class="form-check-label" for="q{{ question.id }}_1">
                    {{ question.option1 }}
                </label>
            </div>
            <div class="form-check my-1">
                <input class="form-check-input" type="radio" name="{{ question.id }}" id="q{{ question.id }}_2" value="2" required>
                <label class="form-check-label" for="q{{ question.id }}_2">
                    {{ question.option2 }}
                </label>
            </div>
            <div class="form-check my-1">
                <input class="form-check-input" type="radio" name="{{ question.id }}" id="q{{ question.id }}_3" value="3" required>
                <label class="form-check-label" for="q{{ question.id }}_3">
                    {{ question.option3 }}
                </label>
            </div>
            <div class="form-check my-1">
                <input class="form-check-input" type="radio" name="{{ question.id }}" id="q{{ question.id }}_4" value="4" required>
                <label class="form-check-label" for="q{{ question.id }}_4">
                    {{ question.option4 }}
                </label>
            </div>
        </div>
    </div>
    {% endfor %}

    <button type="submit" class="btn btn-success mt-3" id="submitBtn">Submit Exam</button>
</form>

<!-- Timer Script -->


<script>
    let totalTime = 5 * 60; 
    const timerDisplay = document.getElementById("timer");
    const form = document.getElementById("examForm");
    const submitBtn = document.getElementById("submitBtn");

    function updateTimer() {
        let minutes = Math.floor(totalTime / 60);
        let seconds = totalTime % 60;

        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

        if (totalTime <= 0) {
            clearInterval(timerInterval);
            alert("Time's up! Submitting your exam.");
            submitBtn.disabled = true;
            form.submit();
        }

        totalTime--;
    }

    form.addEventListener('submit', function(event) {
        const confirmed = confirm('Are you sure you want to submit the exam?');
        if (!confirmed) {
            event.preventDefault();
        }
    });

    updateTimer();
    const timerInterval = setInterval(updateTimer, 1000);
</script>

{% endblock %}
