{% extends 'accounts/base.html' %}

{% block content %}
<style>
    .correct-answer {
        color: green;
        font-weight: bold;
    }

    .wrong-answer {
        color: red;
        font-weight: bold;
    }
</style>

<div class="container my-4">

    <h2 class="mb-4">
        <i class="bi bi-file-earmark-text me-2"></i> Exam Result
    </h2>

    <ul class="list-group mb-4">
        <li class="list-group-item">
            <strong><i class="bi bi-person-fill me-1"></i> Student:</strong> {{ attempt.student.username }}
        </li>
        <li class="list-group-item">
            <strong><i class="bi bi-journal-text me-1"></i> Exam:</strong> {{ attempt.exam.title }}
        </li>
        <li class="list-group-item">
            <strong><i class="bi bi-check2-circle me-1"></i> Score:</strong> {{ marks_earned }} / {{ total_marks }}
        </li>
        <li class="list-group-item">
            <strong><i class="bi bi-percent me-1"></i> Percentage:</strong> {{ rounded_score }}%
        </li>
        <li class="list-group-item">
            <strong><i class="bi bi-calendar-check me-1"></i> Submitted At:</strong> {{ attempt.submitted_at }}
        </li>
        <li class="list-group-item">
            <strong><i class="bi bi-info-circle me-1"></i> Status:</strong>
            {% if rounded_score >= 50 %}
                <span class="badge bg-success">
                    <i class="bi bi-check-lg me-1"></i> Passed
                </span>
            {% else %}
                <span class="badge bg-danger">
                    <i class="bi bi-x-lg me-1"></i> Failed
                </span>
            {% endif %}
        </li>
    </ul>

    <h3><i class="bi bi-question-circle me-2"></i> Answers:</h3>
    <ul class="list-group mb-4">
        {% for ans in answers %}
            <li class="list-group-item">
                <strong>Q{{ forloop.counter }}:</strong> {{ ans.question.question_text }}<br>
                <small><i>Marks: {{ ans.question.marks }}</i></small><br>

                <strong>Your answer:</strong>
                {% if ans.selected_option == 1 %}
                    <span class="{% if ans.selected_option == ans.question.correct_option %}correct-answer{% else %}wrong-answer{% endif %}">
                        {{ ans.question.option1 }}
                    </span>
                {% elif ans.selected_option == 2 %}
                    <span class="{% if ans.selected_option == ans.question.correct_option %}correct-answer{% else %}wrong-answer{% endif %}">
                        {{ ans.question.option2 }}
                    </span>
                {% elif ans.selected_option == 3 %}
                    <span class="{% if ans.selected_option == ans.question.correct_option %}correct-answer{% else %}wrong-answer{% endif %}">
                        {{ ans.question.option3 }}
                    </span>
                {% elif ans.selected_option == 4 %}
                    <span class="{% if ans.selected_option == ans.question.correct_option %}correct-answer{% else %}wrong-answer{% endif %}">
                        {{ ans.question.option4 }}
                    </span>
                {% else %}
                    <span class="wrong-answer">No answer</span>
                {% endif %}
                <br>

                <strong>Correct answer:</strong>
                {% if ans.question.correct_option == 1 %}
                    <span class="correct-answer">{{ ans.question.option1 }}</span>
                {% elif ans.question.correct_option == 2 %}
                    <span class="correct-answer">{{ ans.question.option2 }}</span>
                {% elif ans.question.correct_option == 3 %}
                    <span class="correct-answer">{{ ans.question.option3 }}</span>
                {% elif ans.question.correct_option == 4 %}
                    <span class="correct-answer">{{ ans.question.option4 }}</span>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <a href="{% url 'student_exam_list' %}" class="btn btn-primary">
        <i class="bi bi-arrow-left-circle me-1"></i> Back to Exams
    </a>

</div>
{% endblock %}
